/* --- VARIABLES --- */
:root {
    --book-color: #3e2723;
    --page-color: #fffbf0;
    --title-color: #eaddcf; /* BEIGE */
    --btn-bg: #fff;
    --btn-text: #3e2723;
    --library-opacity: 1; 
    --star-opacity: 0;
}

body.dark-mode {
    --library-opacity: 0;
    --star-opacity: 1;
    --btn-bg: #ffd700;
    --btn-text: #000;
}

body {
    margin: 0; height: 100vh;
    display: flex; justify-content: center; align-items: center;
    background-color: #1a1a1a;
    font-family: 'Georgia', serif;
    overflow: hidden;
    perspective: 1500px; /* Perspective 3D essentielle */
}

/* --- FONDS --- */
/* Étoiles (Géré par JS pour l'aléatoire, style de base ici) */
#stars-container {
    position: absolute; width: 100%; height: 100%; top: 0; left: 0;
    pointer-events: none; z-index: -1; opacity: var(--star-opacity);
    transition: opacity 1s ease;
    background: radial-gradient(circle at center, #0b0b15, #000);
}
.star {
    position: absolute; background: white; border-radius: 50%;
    animation: twinkle infinite ease-in-out;
}
@keyframes twinkle { 0%, 100% { opacity: 0.3; } 50% { opacity: 1; transform: scale(1.2); } }

/* Bibliothèque */
.library-bg {
    position: absolute; top: 0; left: 0; width: 100%; height: 100%; z-index: -2;
    background: 
        linear-gradient(to bottom, rgba(0,0,0,0.4), rgba(0,0,0,0.1)),
        repeating-linear-gradient(90deg, #4a332a 0px, #4a332a 40px, #3e2723 41px, #3e2723 80px);
    opacity: var(--library-opacity);
    transition: opacity 1s ease;
}

/* --- BOUTONS --- */
.controls { position: absolute; top: 20px; z-index: 100; }
button { padding: 10px 20px; border-radius: 20px; border: none; font-weight: bold; background: var(--btn-bg); color: var(--btn-text); cursor: pointer; transition: 0.3s; }

/* --- LIVRE --- */
.book-scene {
    width: 300px; height: 420px; position: relative;
    perspective: 1500px;
}

.book {
    width: 100%; height: 100%; position: relative;
    transform-style: preserve-3d;
    transition: transform 1s ease;
}

/* Quand le livre s'ouvre, on le décale pour qu'il reste centré */
.book.open { transform: translateX(150px); }

.page {
    position: absolute; width: 100%; height: 100%; top: 0; left: 0;
    border-radius: 5px 15px 15px 5px;
    transform-origin: left; /* TOUT TOURNE DEPUIS LA GAUCHE */
    transform-style: preserve-3d;
    box-shadow: inset 10px 0 30px rgba(0,0,0,0.2);
}

/* 1. COUVERTURE AVANT */
.front-cover {
    background: var(--book-color); z-index: 20;
    display: flex; justify-content: center; align-items: center;
    border: 2px solid #2a1510;
    transition: transform 1.5s cubic-bezier(0.2, 0, 0.2, 1);
    
    /* LA SOLUTION MIROIR : On cache le dos de la couverture */
    backface-visibility: hidden; 
}

.cover-content h1 {
    color: var(--title-color); text-align: center; font-size: 2.2em;
    border: 3px solid var(--title-color); padding: 20px; border-radius: 10px;
}

/* 2. INTERIEUR COUVERTURE (Ce qu'on voit quand la couverture tourne) */
.inside-cover {
    background: var(--book-color); z-index: 19;
    transition: transform 1.5s cubic-bezier(0.2, 0, 0.2, 1);
}

/* 3. PAGES */
.inner-page, .left-page-turning, .right-page-fixed {
    background: var(--page-color);
}
.left-page-turning {
    z-index: 15;
    transition: transform 1.6s cubic-bezier(0.2, 0, 0.2, 1);
}
.right-page-fixed {
    z-index: 5; /* Reste en bas */
}

/* 4. COUVERTURE ARRIERE */
.back-cover {
    background: var(--book-color); z-index: 0;
    transform: translateZ(-20px);
    box-shadow: 20px 20px 50px rgba(0,0,0,0.5);
}
.spine {
    position: absolute; left: 0; top: 0; width: 20px; height: 100%;
    background: #2a1510; transform: rotateY(-90deg) translateX(-10px);
    transform-origin: left;
}

/* --- ANIMATION OUVERTURE --- */
/* La couverture tourne à -180deg */
.book.open .front-cover { transform: rotateY(-180deg); }
.book.open .inside-cover { transform: rotateY(-180deg); } /* Suit la couverture */

/* Les pages tournent un peu moins pour l'effet éventail */
.book.open .p1 { transform: rotateY(-176deg); transition-delay: 0.2s; }
.book.open .p2 { transform: rotateY(-172deg); transition-delay: 0.4s; }


/* --- PARTICULES --- */
.particle {
    position: absolute;
    width: 8px; height: 8px;
    background: radial-gradient(circle, #fff, gold);
    border-radius: 50%;
    pointer-events: none;
    z-index: 9999; /* Au dessus de TOUT */
    box-shadow: 0 0 10px gold;
    /* Animation définie ici */
    animation: magicFly 1.5s ease-out forwards;
}

@keyframes magicFly {
    0% { opacity: 1; transform: translate(0, 0) scale(1); }
    100% { opacity: 0; transform: translate(var(--x), var(--y)) scale(0); }
}
